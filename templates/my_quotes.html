{% extends 'base.html' %}

{% block title %}My Quotes - My PEVO{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2><i class="fas fa-file-invoice-dollar me-2"></i>My Quotes</h2>
          <p class="text-muted mb-0">View and manage your saved quotes</p>
        </div>
        <div>
          <a href="{{ url_for('get_quote') }}" class="btn btn-success">
            <i class="fas fa-plus me-2"></i>New Quote
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          {% if quotes %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Quote #</th>
                  <th>Route</th>
                  <th>Pickup Date</th>
                  <th>Car Types</th>
                  <th>Distance</th>
                  <th>Rate Type</th>
                  <th>Total Cost</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for quote in quotes %}
                <tr>
                  <td><strong>#{{ quote.id }}</strong></td>
                  <td>
                    <div class="small">
                      <strong>{{ quote.pickup_location }}, {{ quote.pickup_state }}</strong><br>
                      <i class="fas fa-arrow-down text-muted"></i><br>
                      <strong>{{ quote.delivery_location }}, {{ quote.delivery_state }}</strong>
                    </div>
                  </td>
                  <td>
                    <div>{{ quote.pickup_date.strftime('%m/%d/%Y') }}</div>
                    <small class="text-muted">{{ quote.pickup_time }}</small>
                  </td>
                  <td>
                    {% for car_type in quote.car_types|from_json %}
                      <span class="badge bg-info me-1">{{ car_type }}</span>
                    {% endfor %}
                    {% if quote.is_superload %}
                      <span class="badge bg-warning">Superload</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if quote.distance_miles %}
                      {{ "%.1f"|format(quote.distance_miles) }} mi
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if quote.rate_type %}
                      <span class="badge bg-{{ 'warning' if quote.rate_type == 'premium' else 'success' }}">
                        {{ quote.rate_type.title() }}
                      </span>
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>
                    {% if quote.total_cost %}
                      <strong>${{ "%.2f"|format(quote.total_cost) }}</strong>
                    {% else %}
                      -
                    {% endif %}
                  </td>
                  <td>{{ quote.created_at.strftime('%m/%d/%Y %H:%M') }}</td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <button type="button" class="btn btn-outline-primary" onclick="viewQuote({{ quote.id }})" title="View Details">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button type="button" class="btn btn-outline-secondary" onclick="duplicateQuote({{ quote.id }})" title="Duplicate">
                        <i class="fas fa-copy"></i>
                      </button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center py-5">
            <i class="fas fa-file-invoice-dollar text-muted" style="font-size: 4rem;"></i>
            <h4 class="mt-3 text-muted">No quotes yet</h4>
            <p class="text-muted">Create your first quote to get started</p>
            <a href="{{ url_for('get_quote') }}" class="btn btn-success">
              <i class="fas fa-plus me-2"></i>Create First Quote
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quote Details Modal -->
<div class="modal fade" id="quoteModal" tabindex="-1" aria-labelledby="quoteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="quoteModalLabel">Quote Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="quoteModalBody">
        <!-- Quote details will be loaded here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="printQuote()">
          <i class="fas fa-print me-2"></i>Print Quote
        </button>
      </div>
    </div>
  </div>
</div>

<script>
function viewQuote(quoteId) {
  // This would fetch and display quote details in a modal
  const modalBody = document.getElementById('quoteModalBody');
  modalBody.innerHTML = `
    <div class="text-center py-4">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading quote details...</p>
    </div>
  `;
  
  // Show modal
  const modal = new bootstrap.Modal(document.getElementById('quoteModal'));
  modal.show();
  
  // Simulate loading quote details (in a real implementation, you'd fetch from server)
  setTimeout(() => {
    modalBody.innerHTML = `
      <div class="alert alert-info">
        <strong>Quote #${quoteId}</strong> - Detailed view functionality will be implemented
      </div>
      <p>This would show:</p>
      <ul>
        <li>Complete trip details</li>
        <li>Detailed cost breakdown</li>
        <li>Regional pricing information</li>
        <li>Terms and conditions</li>
      </ul>
    `;
  }, 1000);
}

function duplicateQuote(quoteId) {
  if (confirm('This will create a new quote based on Quote #' + quoteId + '. Continue?')) {
    // This would redirect to the get-quote page with pre-filled data
    alert('Duplicate functionality will redirect to Get Quote page with pre-filled data');
    // window.location.href = '/get-quote?duplicate=' + quoteId;
  }
}

function printQuote() {
  window.print();
}
</script>
{% endblock %}
